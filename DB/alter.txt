CREATE DATABASE postinsurance DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

mysql> grant all privileges on postinsurance.* to yunying@localhost identified by '123456';

mysql> grant all privileges on postinsurance.* to yunying@'%' identified by '123456';


-- 20150506
alter table t_policy add column operate_id bigint;
alter table t_policy add column operate_name date;
alter table t_policy add column operate_time varchar(32);

--20150530
alter table t_bank_code add column bank_name varchar(128);
alter table t_prd add column multiple int;

--20150604
drop table if exists t_policy;

/*==============================================================*/
/* Table: t_policy                                              */
/*==============================================================*/
create table t_policy
(
   id                   bigint not null auto_increment,
   organ_code           varchar(20),
   organ_name           varchar(60),
   policy_no            varchar(12),
   form_no              varchar(25),
   holder               varchar(256),
   insured              varchar(256),
   prod_code            varchar(8),
   prod_name            varchar(128),
   policy_fee           varchar(256),
   insured_amount       varchar(256),
   fee_frequency        varchar(10),
   perm                 int,
   plicy_valid_date     date,
   policy_date          date,
   status               int,
   bank_id              bigint,
   bank_code            varchar(12),
   bank_name            varchar(128),
   sales_name           varchar(256),
   sales_id             varchar(256),
   copies               varchar(256),
   renewal_sucess_flag  int,
   reset_valid_flag     int,
   operate_id           bigint,
   operate_time         date,
   operate_name         varchar(32),
   primary key (id)
)
engine=innodb auto_increment=1 default charset=utf8;

alter table t_policy add column
organ_code           varchar(20),
add column   organ_name           varchar(60),
add column   policy_no            varchar(12),
add column   form_no              varchar(25),
add column   holder               varchar(256),
add column   insured              varchar(256),
add column   prod_code            varchar(8),
add column   prod_name            varchar(128),
add column   policy_fee           varchar(256),
add column   insured_amount       varchar(256),
add column   fee_frequency        varchar(10),
add column   perm                 int,
add column   plicy_valid_date     date,
add column   policy_date          date,
add column   status               int,
add column   bank_id              bigint,
add column   bank_code            varchar(12),
add column   bank_name            varchar(128),
add column   sales_name           varchar(256),
add column   sales_id             varchar(256),
add column   copies               varchar(256),
add column   renewal_sucess_flag  int,
add column   reset_valid_flag     int,
add column   operate_id           bigint,
add column   operate_time         date,
add column   operate_name         varchar(32);

drop table if exists t_policy_dtl;

/*==============================================================*/
/* Table: t_policy_dtl                                          */
/*==============================================================*/
create table t_policy_dtl
(
   id                   bigint not null auto_increment,
   organ_code           varchar(60),
   policy_no            varchar(12),
   holder               varchar(256),
   holder_sexy          int,
   insured              varchar(256),
   prod_name            varchar(128),
   insured_amount       varchar(256),
   policy_fee           varchar(256),
   sales_name           varchar(256),
   policy_date          date,
   holder_phone         varchar(256),
   holder_mobile        varchar(256),
   holder_addr          varchar(512),
   holder_postcode      varchar(6),
   holder_card_type     int,
   holder_card_num      varchar(256),
   operate_id           bigint,
   operate_time         date,
   primary key (id)
)
engine=innodb auto_increment=1 default charset=utf8;

alter table t_issue add column
   organ_code           varchar(18),
add column      call_man             varchar(8),
add column      issue_no             varchar(12),
add column      policy_no            varchar(18),
add column      issue_desc           varchar(6),
add column      issue_type           varchar(10),
add column      issue_content        varchar(256),
add column      result       varchar(256),
add column      ready_date           timestamp default current_timestamp,
add column      finish_date          datetime,
add column      bank_code            varchar(20),
add column      bank_name            varchar(256),
add column      should_date          date,
add column      call_date            date,
add column      issue_date           date,
add column      reset_num            int,
add column      recall_flag          varchar(2),
add column      issue_time           date,
add column      status               varchar(10),
add column      deal_man             varchar(32),
add column      deal_time            date,
add column      reopen_reason        varchar(256),
add column      reopen_id            bigint,
add column      reopen_date          date,
add column      operate_id          bigint,
add column      operate_time          timestamp default current_timestamp;


alter table t_policy 
add column   customer_manager_code         varchar(25),
add column   customer_manager              varchar(16);


INSERT INTO t_renewed_list(policy_no, fee_status, fee_fail_reason, prd_name) 
VALUES
('86440100003942', '你好', 'Eliot', '中邮附加重大疾病保险'),
('86440100003942', 'hello', 'Jhon', '中邮年年好B款年金保险（分红型）'), 
('86440100005030', '嘻嘻', 'Jim', '中邮年年好百倍保两全保险') 
ON DUPLICATE KEY UPDATE 
policy_no=VALUES(policy_no), prd_name=VALUES(prd_name), 
fee_status=VALUES(fee_status), fee_fail_reason=VALUES(fee_fail_reason);

alter table t_renewed_list
add column fix_status           varchar(12),
add column    fix_desc             varchar(256),
add column    deal_man             varchar(12),
add column    deal_time            date;

alter table t_call_fail_list add column organ_name varchar(20);
alter table t_issue add column organ_name varchar(20);
alter table t_call_fail_list add column hq_deal_num int;
alter table t_call_fail_list add column prov_deal_num int;
alter table t_issue add column holder_mobile varchar(256);
alter table t_issue add column holder_phone varchar(256);
alter table t_call_fail_list add column holder_phone varchar(256);
alter table t_call_fail_list add column holder_mobile varchar(256);

/* 2015-08-06*/
alter table `t_call_fail_list` add column reset_phone VARCHAR(256);
--------------- SQL ---------------

ALTER TABLE `t_call_fail_list` ADD COLUMN `org_deal_flag` TINYINT(4) DEFAULT 0;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_flag` TINYINT(4) DEFAULT 0;
ALTER TABLE `t_call_fail_list` ADD COLUMN `prov_deal_flag` TINYINT(4) DEFAULT 0;

===============20150810
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_date6` date DEFAULT NULL AFTER `hq_deal_rst5`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_rst6` VARCHAR(120) DEFAULT NULL AFTER `hq_deal_date6`;
--------------- SQL ---------------

ALTER TABLE `t_call_fail_list` ADD COLUMN `has_letter` VARCHAR(32) DEFAULT NULL;

--------------- SQL ---------------

ALTER TABLE `t_call_fail_list` ADD COLUMN `letter_date` DATE DEFAULT NULL;

--------------- SQL ---------------

CREATE OR REPLACE  ALGORITHM=UNDEFINED DEFINER='root'@'localhost' SQL SECURITY DEFINER VIEW `v_call_fail_list`
AS
select
  `a`.*,
  (`b`.`policy_date` + interval 12 day) AS `check_date`,
  (`b`.`policy_date` + interval 15 day) AS `end_date`,
  (to_days((`b`.`policy_date` + interval 15 day)) - to_days(now())) AS `last_date_num`
from
  (`t_call_fail_list` `a`
  join `t_policy` `b`)
where
  (`a`.`policy_no` = `b`.`policy_no`);

======20150817
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type` varchar(20) DEFAULT NULL AFTER `hq_issue_type`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man` varchar(20) DEFAULT NULL AFTER `hq_deal_type`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type2` varchar(20) DEFAULT NULL AFTER `hq_deal_date2`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man2` varchar(20) DEFAULT NULL AFTER `hq_deal_type2`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type3` varchar(20) DEFAULT NULL AFTER `hq_deal_date3`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man3` varchar(20) DEFAULT NULL AFTER `hq_deal_type3`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type4` varchar(20) DEFAULT NULL AFTER `hq_deal_date4`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man4` varchar(20) DEFAULT NULL AFTER `hq_deal_type4`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type5` varchar(20) DEFAULT NULL AFTER `hq_deal_date5`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man5` varchar(20) DEFAULT NULL AFTER `hq_deal_type5`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_type6` varchar(20) DEFAULT NULL AFTER `hq_deal_date6`;
ALTER TABLE `t_call_fail_list` ADD COLUMN `hq_deal_man6` varchar(20) DEFAULT NULL AFTER `hq_deal_type6`;